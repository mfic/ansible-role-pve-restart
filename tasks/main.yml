---
# tasks/main.yml â€” role entry point
#
# Rolling OS reboot order (per play):
#   1. preflight checks (run_once per play)
#   2. discover PVE node name
#   3. evacuate node (HA maintenance + migrate non-HA + Ceph noout)
#   4. reboot + wait for PVE services
#   5. restore node (Ceph noout unset + HA maintenance disable)
#   6. verify cluster health
#
# Expected play setup:
#   serial: 1
#
# Note: become_flags '-i' is required so that sudo creates a login shell,
# giving PVE CLI tools (pvecm, ha-manager, qm, pct) access to the
# pve-cluster IPC socket.

- block:
    - name: Run node lifecycle with retry support
      ansible.builtin.include_tasks: node_lifecycle.yml
  become: true
  become_flags: '-i'
